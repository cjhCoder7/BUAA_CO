## P1 课下感想☹️

### NPC

端口定义

| 信号名      | 方向 | 描述                                         |
| ----------- | ---- | -------------------------------------------- |
| PC[31:0]    | I    | 当前指令的地址                               |
| Imm16[15:0] | I    | beq：16位偏移（`sw`或`lw`指令）              |
| Imm26[25:0] | I    | jal：26位偏移（`j`或`jal`指令）              |
| RA32[31:0]  | I    | jr：`$ra`寄存器保存的32位目标地址            |
| NPCop[1:0]  | I    | NPC计算模式的控制码                          |
| Zero        | I    | `rs`与`rt`相等的比较结果；1：相等；0：不相等 |
| NPC[31:0]   | O    | 下一条指令的地址                             |
| PC4[31:0]   | O    | 当前指令加4的地址                            |

**NPCop 选择器**

| NPCop | 功能                     |
| ----- | ------------------------ |
| 00    | PC + 4                   |
| 01    | PC + 4 + sign_ext(Imm16) |
| 10    | PC + 4 + sign_ext(Imm26) |
| 11    | `$ra` 寄存器的地址       |

### IM

端口定义

| 信号名            | 方向 | 描述       |
| ----------------- | ---- | ---------- |
| PC[31:0]          | I    | 指令的地址 |
| Instruction[31:0] | O    | 取出的指令 |

### EXT

端口定义

| 信号名      | 方向 | 描述                   |
| ----------- | ---- | ---------------------- |
| Imm16[15:0] | I    | 16位数                 |
| EXTop       | I    | 0：零扩展；1：符号扩展 |
| 32bit[31:0] | O    | 扩展后的32位数         |

### RF

端口定义

| 信号名    | 方向 | 描述                                                        |
| --------- | ---- | ----------------------------------------------------------- |
| A1[4:0]   | I    | 5位地址输入信号，将其储存的数据读出到 RD1（`rs`）           |
| A2[4:0]   | I    | 5位地址输入信号，将其储存的数据读出到 RD2（`rt`）           |
| A3[4:0]   | I    | 5位地址输入信号，将其作为写入数据的目标寄存器（`rd`寄存器） |
| WD[31:0]  | I    | 要写入的32位数据                                            |
| RFWr      | I    | 寄存器堆写使能信号：1：写使能信号有效；0：写使能信号无效    |
| Clk       | I    | 时钟信号                                                    |
| Reset     | I    | 异步复位信号：1：复位信号有效；0：复位信号无效              |
| RD1[31:0] | O    | 输出A1指定的寄存器中的32位数据                              |
| RD2[31:0] | O    | 输出A2指定的寄存器中的32位数据                              |

### ALU

端口定义

| 信号名        | 方向 | 描述               |
| ------------- | ---- | ------------------ |
| A[31:0]       | I    | 32位输入A          |
| B[31:0]       | I    | 32位输入B          |
| C[31:0]       | I    | 32位输出C          |
| ALUop[3:0]    | I    | 运算控制信号       |
| Zero          | O    | A = B：1；否则为0  |
| Less          | O    | A < B：1；否则为0  |
| Less or Equal | O    | A <= B：1；否则为0 |

**ALUop说明**

| 信号值  | 功能                               |
| ------- | ---------------------------------- |
| 4'b0000 | A + B                              |
| 4'b0001 | A - B                              |
| 4'b0010 | A \| B                             |
| 4'b0011 | A & B                              |
| 4'b0100 | lui 指令                           |
| 4‘b0101 | 算数左移/逻辑左移                  |
| 4'b0110 | 算数右移（左边添加的数和符号有关） |
| 4'b0111 | 逻辑右移（左边统一添0）            |

### DM

端口定义

| 信号名   | 方向 | 描述                                                 |
| -------- | ---- | ---------------------------------------------------- |
| A[31:0]  | I    | 内存中的地址信号                                     |
| WD[31:0] | I    | 在写入信号有效时，写入内存地址的数据                 |
| DMWr     | I    | 内存写使能信号：1：写使能信号有效；0：写使能信号无效 |
| Clk      | I    | 时钟信号                                             |
| Reset    | I    | 异步复位信号：1：复位信号有效；0：复位信号无效       |
| RD[31:0] | O    | 输出内存中对应地址的数据                             |

### Control

| 端口  | add  | sub  | ori  | lw   | sw   | beq  | lui  | nop  |
| ----- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| NPCop | 00   | 00   | 00   | 00   | 00   | 01   | 00   | xx   |
| WRsel | 1    | 1    | 0    | 0    | x    | x    | 0    | x    |
| EXTop | x    | x    | 0    | 1    | 1    | x    | 0    | x    |
| WDsel | 00   | 00   | 00   | 01   | xx   | xx   | 00   | xx   |
| RFWr  | 1    | 1    | 1    | 1    | 0    | 0    | 1    | x    |
| Bsel  | 0    | 0    | 1    | 1    | 1    | 0    | 1    | x    |
| ALUop | 0000 | 0001 | 0010 | 0000 | 0000 | 0001 | 0100 | xxxx |
| DMWr  | 0    | 0    | 0    | 0    | 1    | 0    | 0    | x    |

